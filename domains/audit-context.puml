' ========================
' 审核治理上下文
' ========================
package "Audit Governance" {
    class AuditRecord <<Entity>> {
      - recordId: String
      - targetId: String
      - targetType: AuditTarget
      - creationDate: DateTime
      - lastUpdateDate: DateTime
      - finalResult: AuditResult
      - comment: String
      - approvalChain: List<ApprovalStep>
      + addComment(comment: String, auditor: UserId)
      + approve(auditor: UserId)
      + reject(auditor: UserId, reason: String)
      + assignNextAuditor(auditor: UserId)
    }

    class AuditPolicy <<AggregateRoot>> {
      - policyId: String
      - name: String
      - description: String
      - targetType: AuditTarget
      - requiredApprovals: Int
      - isActive: boolean
      - workflow: AuditWorkflow
      + executeAudit(targetId: String): AuditRecord
      + activatePolicy()
      + deactivatePolicy()
      + updateWorkflow(workflow: AuditWorkflow)
    }

    class ApprovalStep <<ValueObject>> {
        - stepOrder: Int
        - approvalRole: ServiceGroupRoleType
        - auditor: UserId
        - auditResult: AuditResult
        - auditDate: DateTime
        - comment: String
    }

    enum AuditResult {
        APPROVED
        REJECTED
        PENDING
    }

    enum AuditTarget {
        USER_QUALIFICATION
        PROJECT
        SERVICE_MEMBER
    }

    class AuditWorkflow <<Entity>> {
      - workflowId: String
      - steps: List<AuditWorkflowStep>
      - questionnaire: AutomatedQuestionnaire
      + addStep(role: ServiceGroupRoleType, order: Int)
      + removeStep(order: Int)
      + getNextApprover(currentStep: Int): ServiceGroupRoleType
    }

    class AuditWorkflowStep <<ValueObject>> {
      - order: Int
      - approverRole: ServiceGroupRoleType
      - isAutomatic: Boolean
    }

    class AutomatedQuestionnaire <<Entity>> {
      - questionnaireId: String
      - targetType: AuditTarget
      - questions: List<Question>
      - passingScore: Int
      + evaluate(answers: Map<String, String>): Int
    }

    class Question <<ValueObject>> {
      - questionId: String
      - content: String
      - weight: Int
      - expectedAnswer: String
      + validate(answer: String): Boolean
    }

    ' ----- Relationships -----
    AuditPolicy "1" *-- "1" AuditWorkflow : defines >
    AuditPolicy "1" --> "0..*" AuditRecord : creates >
    AuditWorkflow "1" *-- "0..*" AuditWorkflowStep : contains >
    AuditWorkflow "1" --> "0..1" AutomatedQuestionnaire : may include >
    AutomatedQuestionnaire "1" *-- "1..*" Question : consists of >
    AuditRecord "1" *-- "1..*" ApprovalStep : tracks >
    
    User "1" --> "0..*" AuditRecord : subject to > 
    Project "1" --> "0..*" AuditRecord : subject to >
    ServiceGroupMember "1" --> "0..*" AuditRecord : performs >
}

